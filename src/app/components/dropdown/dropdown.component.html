@if(showLabel()) {
<label for="select-core" class="font-bold text-gray-700">{{ label() }}</label>
}
<div class="relative size-full">
  <!-- BotÃ³n que abre el dropdown -->
  <button
    type="button"
    (click)="toggleOpen()"
    class="size-full px-3 flex justify-between items-center shadow-sm p-2 rounded-lg bg-white transition-all duration-150"
    [ngClass]="{
      'cursor-not-allowed bg-gray-300/25 opacity-50': disabled(),
      'cursor-pointer bg-white': !disabled(),
      'border-primary-500': open()
    }"
  >
    <span class="flex items-center gap-2 overflow-hidden">
      @if (inputLoading()) {
      <img
        src="gif/spinner.gif"
        alt="cargando"
        class="h-8 w-auto object-contain"
      />
      } @if (value()?.img) {
      <img src="{{ value()?.img }}" alt="" class="size-10 object-contain" />
      }
      <span
        class="truncate overflow-hidden pl-1"
        [ngClass]="{
          'text-black': value()?.label,
          'text-gray-400': !value()?.label
        }"
      >
        {{ value()?.label || "Selecciona " + labelItemType() }}
      </span>
    </span>
    <svg
      class="w-4 h-4 ml-2"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      viewBox="0 0 24 24"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <!-- Dropdown -->
  @if (open()) {
  <div
    class="absolute z-50 w-full bg-white border border-neutral-200 mt-1 rounded-md shadow-lg"
  >
    <!-- Input buscador -->
    @if(canSearch()) {
    <input
      [ngModel]="search()"
      (ngModelChange)="onSearchChange($event)"
      type="text"
      [placeholder]="'Busca ' + labelItemType()"
      class="w-full px-3 py-2 border-b outline-none text-sm border-neutral-200 placeholder:text-neutral-400"
    />
    }

    <!-- Opciones -->
    <ul class="max-h-56 dropdown-panel" (scroll)="onScroll($event)">
      @if (search().length == 0 && canSelectNull()) {
      <li
        (click)="select({ label: '', secondaryLabel: '', object: '' })"
        class="px-3 py-2 hover:bg-gray-100 flex items-center gap-2 cursor-pointer"
      >
        <span class="font-thin">- Selecciona un item -</span>
      </li>
      } @for (item of filteredItems(); track $index) {
      <li
        (click)="select(item)"
        class="px-3 py-2 hover:bg-gray-100 flex items-center gap-2 cursor-pointer"
        [ngClass]="{
          'bg-primary-500/15 hover:bg-primary-500/25':
            value()?.object === item.object
        }"
      >
        @if (item.img) {
        <img [src]="item.img" class="size-10 object-contain" />
        }
        <div>
          <div class="font-bold">{{ item.label }}</div>
          <div class="text-xs text-gray-500">{{ item.secondaryLabel }}</div>
        </div>
      </li>
      <!-- Si no hay resultados -->
      @if (filteredItems().length === 0) {
      <li class="px-3 py-2 text-gray-400 text-sm">No encontrado</li>
      } }
    </ul>
  </div>
  }
</div>
